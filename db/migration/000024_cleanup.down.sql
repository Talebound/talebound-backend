CREATE TABLE "chat" (
    "id" bigserial PRIMARY KEY,
    "user_id" int NOT NULL,
    "text" varchar NOT NULL,
    "created_at" timestamp NOT NULL DEFAULT (now())
);

CREATE TABLE "races" (
    "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "world_id" int NOT NULL,
    "name" varchar NOT NULL,
    "img_id" int,
    "is_playable" boolean NOT NULL DEFAULT true
);

CREATE TABLE "properties" (
    "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "world_id" int NOT NULL,
    "name" varchar NOT NULL
);

CREATE TABLE "race_properties" (
    "race_id" int NOT NULL,
    "property_id" int NOT NULL,
    "min_value" int NOT NULL,
    "max_value" int NOT NULL
);

ALTER TABLE "characters"
    ADD COLUMN "user_id" int,
    ADD COLUMN "world_id" int,
    ADD COLUMN "race_id" int,
    ADD COLUMN "img_id" int,
    ADD COLUMN "name" varchar,
    ADD COLUMN "level" int,
    ADD COLUMN "experience" int,
    ADD COLUMN "skill_points" int,
    ADD COLUMN "property_points" int,
    ADD COLUMN "created_at" timestamptz NOT NULL DEFAULT (now())
;

CREATE TABLE "character_properties" (
    "character_id" int NOT NULL,
    "property_id" int NOT NULL,
    "value" int NOT NULL
);

CREATE TABLE "skills" (
    "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "world_id" int NOT NULL,
    "img_id" int,
    "name" varchar NOT NULL,
    "max_level" int NOT NULL
);

CREATE TABLE "skill_requirements" (
    "id" int PRIMARY KEY,
    "skill_id" int NOT NULL,
    "level" int,
    "race_id" int
);

CREATE TABLE "skill_requirement_skills" (
    "skill_requirement_id" int NOT NULL,
    "skill_id" int NOT NULL,
    "level" int NOT NULL
);

CREATE TABLE "skill_requirement_properties" (
    "skill_requirement_id" int NOT NULL,
    "property_id" int NOT NULL,
    "value" int NOT NULL
);

CREATE TABLE "character_skills" (
    "character_id" int NOT NULL,
    "skill_id" int NOT NULL,
    "skill_level" int NOT NULL
);

CREATE UNIQUE INDEX ON "races" ("world_id", "name");

CREATE UNIQUE INDEX ON "properties" ("world_id", "name");

CREATE UNIQUE INDEX ON "race_properties" ("race_id", "property_id");

CREATE UNIQUE INDEX ON "characters" ("world_id", "name");

CREATE UNIQUE INDEX ON "character_properties" ("character_id", "property_id");

ALTER TABLE "chat" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "races" ADD FOREIGN KEY ("world_id") REFERENCES "worlds" ("id");

ALTER TABLE "races" ADD FOREIGN KEY ("img_id") REFERENCES "images" ("id");

ALTER TABLE "properties" ADD FOREIGN KEY ("world_id") REFERENCES "worlds" ("id");

ALTER TABLE "race_properties" ADD FOREIGN KEY ("race_id") REFERENCES "races" ("id");

ALTER TABLE "race_properties" ADD FOREIGN KEY ("property_id") REFERENCES "properties" ("id");

ALTER TABLE "characters" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");

ALTER TABLE "characters" ADD FOREIGN KEY ("world_id") REFERENCES "worlds" ("id");

ALTER TABLE "characters" ADD FOREIGN KEY ("race_id") REFERENCES "races" ("id");

ALTER TABLE "characters" ADD FOREIGN KEY ("img_id") REFERENCES "images" ("id");

ALTER TABLE "character_properties" ADD FOREIGN KEY ("character_id") REFERENCES "characters" ("id");

ALTER TABLE "character_properties" ADD FOREIGN KEY ("property_id") REFERENCES "properties" ("id");

ALTER TABLE "skills" ADD FOREIGN KEY ("world_id") REFERENCES "worlds" ("id");

ALTER TABLE "skills" ADD FOREIGN KEY ("img_id") REFERENCES "images" ("id");

ALTER TABLE "skill_requirements" ADD FOREIGN KEY ("skill_id") REFERENCES "skills" ("id");

ALTER TABLE "skill_requirements" ADD FOREIGN KEY ("race_id") REFERENCES "races" ("id");

ALTER TABLE "skill_requirement_skills" ADD FOREIGN KEY ("skill_requirement_id") REFERENCES "skill_requirements" ("id");

ALTER TABLE "skill_requirement_skills" ADD FOREIGN KEY ("skill_id") REFERENCES "skills" ("id");

ALTER TABLE "skill_requirement_properties" ADD FOREIGN KEY ("skill_requirement_id") REFERENCES "skill_requirements" ("id");

ALTER TABLE "skill_requirement_properties" ADD FOREIGN KEY ("property_id") REFERENCES "properties" ("id");

ALTER TABLE "character_skills" ADD FOREIGN KEY ("character_id") REFERENCES "characters" ("id");

ALTER TABLE "character_skills" ADD FOREIGN KEY ("skill_id") REFERENCES "skills" ("id");
